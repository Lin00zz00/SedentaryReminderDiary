<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•æ¬¡èµ·èº«è®°å½•</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .question {
            margin-bottom: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            transition: transform 0.2s;
        }

        .question:hover {
            transform: translateY(-2px);
        }

        .question-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            background: white;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option:hover {
            border-color: #4CAF50;
            background: #f1f8e9;
        }

        .option.selected {
            border-color: #4CAF50;
            background: #e8f5e9;
        }

        .rating-options {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .rating-option {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .rating-option.selected {
            background: #4CAF50;
            color: white;
        }

        .submit-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .emoji {
            font-size: 24px;
        }

        .other-input {
            margin-top: 10px;
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
        }

        .other-input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        #report-container {
            display: none;
            position: fixed;
            top: -9999px;
            left: -9999px;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            width: 600px;
            max-width: 90vw;
            z-index: 9999;
        }

        .report-header {
            text-align: center;
            margin-bottom: 40px;
            color: #2c3e50;
        }

        .report-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .report-content {
            font-size: 18px;
            line-height: 1.8;
            color: #333;
        }

        .report-item {
            margin-bottom: 20px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .report-footer {
            margin-top: 40px;
            text-align: center;
            color: #666;
            font-size: 16px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px 40px;
            border-radius: 10px;
            z-index: 1000;
            font-size: 16px;
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .question {
                padding: 15px;
            }
            
            .option {
                padding: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>å•æ¬¡èµ·èº«è®°å½•</h1>
        </div>

        <div class="question">
            <div class="question-title">ğŸ“ æœ¬æ¬¡ä½ è¿ç»­åäº†å¤šä¹…ï¼Ÿ</div>
            <div class="options">
                <div class="option" data-value="less-than-30">ğŸ•’ å°äº30åˆ†é’Ÿ</div>
                <div class="option" data-value="30-60">ğŸ•’ 30åˆ†é’Ÿ - 1å°æ—¶</div>
                <div class="option" data-value="1-2">ğŸ•’ 1-2å°æ—¶</div>
                <div class="option" data-value="more-than-2">ğŸ•’ 2å°æ—¶ä»¥ä¸Š</div>
            </div>
        </div>

        <div class="question">
            <div class="question-title">ğŸ“ ä½ è¿™æ¬¡èµ·èº«çš„ä¸»è¦åŸå› ï¼Ÿï¼ˆå¤šé€‰ï¼‰</div>
            <div class="options">
                <div class="option" data-value="A1">ğŸ‘‰ å£æ¸´/å¦‚å•/åƒä¸œè¥¿</div>
                <div class="option" data-value="B1">ğŸ‘‰ è®¾å¤‡æé†’ï¼ˆæ‰‹æœº/æ‰‹ç¯/ç”µè„‘ç­‰ï¼‰</div>
                <div class="option" data-value="B2">ğŸ‘‰ ä»–äººæé†’</div>
                <div class="option" data-value="C1">ğŸ‘‰ è‡ªå·±è§‰å¾—éœ€è¦æ´»åŠ¨ä¸€ä¸‹</div>
                <div class="option" data-value="C2">ğŸ‘‰ è§‰å¾—èº«ä½“ä¸é€‚</div>
                <div class="option" data-value="C3">ğŸ‘‰ æ¥ç”µè¯/å–å¤–å–/å…¶ä»–ä»»åŠ¡ä¸­æ–­</div>
                <div class="option" data-value="other">ğŸ‘‰ å…¶ä»–</div>
            </div>
            <input type="text" class="other-input" placeholder="è¯·è¾“å…¥å…¶ä»–åŸå› ..." id="other-reason">
        </div>

        <div class="question">
            <div class="question-title">ğŸ“ ä½ æœ¬æ¬¡/æœ€è¿‘ä¸€æ¬¡æ”¶åˆ°ä¹…åæé†’çš„æ„Ÿå—ï¼Ÿ</div>
            <div class="options">
                <div class="option" data-value="mood-5">ğŸ˜„ 5åˆ† - å¼€å¿ƒï¼Œæ­£å¥½æƒ³åŠ¨ä¸€åŠ¨</div>
                <div class="option" data-value="mood-4">ğŸ™‚ 4åˆ† - è¿˜è¡Œï¼Œèƒ½æ¥å—æé†’</div>
                <div class="option" data-value="mood-3">ğŸ˜ 3åˆ† - ä¸€èˆ¬ï¼Œæ²¡ä»€ä¹ˆæ„Ÿè§‰</div>
                <div class="option" data-value="mood-2">ğŸ™„ 2åˆ† - æœ‰ç‚¹çƒ¦ï¼Œä½†è¿˜æ˜¯ç«™èµ·æ¥äº†</div>
                <div class="option" data-value="mood-1">ğŸ˜‘ 1åˆ† - å¾ˆçƒ¦ï¼Œæ— è§†äº†æé†’</div>
            </div>
        </div>

        <div class="question">
            <div class="question-title">ğŸ“ æé†’æ–¹å¼çš„æ¥å—åº¦ï¼Ÿï¼ˆ1-5åˆ†è¯„åˆ†ï¼‰</div>
            <div class="options">
                <div class="option" data-value="accept-1">ğŸ˜Š 1åˆ† - å®Œå…¨ä¸ä»‹æ„</div>
                <div class="option" data-value="accept-2">ğŸ™‚ 2åˆ† - å¯ä»¥æ¥å—</div>
                <div class="option" data-value="accept-3">ğŸ˜ 3åˆ† - ä¸­æ€§</div>
                <div class="option" data-value="accept-4">ğŸ™„ 4åˆ† - æœ‰ç‚¹çƒ¦èº</div>
                <div class="option" data-value="accept-5">ğŸ˜« 5åˆ† - éå¸¸åæ„Ÿ</div>
            </div>
        </div>

        <div class="question">
            <div class="question-title">ğŸ“ ä½ å½“æ—¶æ­£åœ¨åšçš„äº‹æƒ…ï¼Ÿ</div>
            <div class="options">
                <div class="option" data-value="task-urgent">âš¡ å¤„ç†ç´§æ€¥ä»»åŠ¡ï¼ˆèµ¶deadline/é‡è¦ä¼šè®®ï¼‰</div>
                <div class="option" data-value="task-focus">ğŸ§  éœ€è¦ä¸“æ³¨æ€è€ƒï¼ˆå†™ä»£ç /å†™è®ºæ–‡ï¼‰</div>
                <div class="option" data-value="task-light">ğŸ’» è½»åº¦å·¥ä½œ/å¨±ä¹ï¼ˆæµè§ˆç½‘é¡µ/çœ‹è§†é¢‘ï¼‰</div>
                <div class="option" data-value="task-other">å…¶ä»–</div>
            </div>
            <input type="text" class="other-input" placeholder="è¯·è¾“å…¥å…¶ä»–æ´»åŠ¨..." id="other-task">
        </div>

        <div class="question">
            <div class="question-title">ğŸ“ ä½ èµ·èº«ååšäº†ä»€ä¹ˆï¼Ÿï¼ˆå¤šé€‰ï¼‰</div>
            <div class="options">
                <div class="option" data-value="activity-sit">ğŸª‘ åªæ˜¯æ¢äº†ä¸ªå§¿åŠ¿ç»§ç»­å</div>
                <div class="option" data-value="activity-toilet">ğŸš½ ä¸Šå•æ‰€</div>
                <div class="option" data-value="activity-water">ğŸ’§ å–æ°´</div>
                <div class="option" data-value="activity-walk">ğŸš¶â€â™‚ï¸ ç®€å•èµ°åŠ¨å‡ æ­¥</div>
                <div class="option" data-value="activity-exercise">ğŸ’ª è®¤çœŸåšäº†ä¸ªæ‹‰ä¼¸/è¿åŠ¨</div>
                <div class="option" data-value="activity-other">å…¶ä»–</div>
            </div>
            <input type="text" class="other-input" placeholder="è¯·è¾“å…¥å…¶ä»–æ´»åŠ¨..." id="other-activity">
        </div>

        <div class="question">
            <div class="question-title">ğŸ“ æ´»åŠ¨æŒç»­æ—¶é—´ï¼Ÿ</div>
            <div class="options">
                <div class="option" data-value="duration-less-1">â±ï¸ å°‘äº1åˆ†é’Ÿ</div>
                <div class="option" data-value="duration-1-5">â±ï¸ 1-5åˆ†é’Ÿ</div>
                <div class="option" data-value="duration-more-5">â±ï¸ 5åˆ†é’Ÿä»¥ä¸Š</div>
            </div>
        </div>

        <div class="question">
            <div class="question-title">ğŸ“ è¿”å›åº§ä½åçš„çŠ¶æ€å˜åŒ–ï¼Ÿ</div>
            <div class="options">
                <div class="option" data-value="status-better">âœ¨ æ„Ÿè§‰æ³¨æ„åŠ›æå‡äº†</div>
                <div class="option" data-value="status-worse">ğŸ˜« æ„Ÿè§‰æ›´ç–²åŠ³</div>
                <div class="option" data-value="status-same">ğŸ˜ æ²¡å¤ªå¤§å˜åŒ–</div>
                <div class="option" data-value="status-other">å…¶ä»–</div>
            </div>
            <input type="text" class="other-input" placeholder="è¯·è¾“å…¥å…¶ä»–çŠ¶æ€..." id="other-status">
        </div>

        <div class="question">
            <div class="question-title">ğŸ“ ä½ å½“æ—¶æ˜¯ç‹¬è‡ªä¸€äººè¿˜æ˜¯æœ‰åŒäº‹/å®¶äººï¼Ÿ</div>
            <div class="options">
                <div class="option" data-value="alone">ğŸ‘¤ ç‹¬å¤„</div>
                <div class="option" data-value="with-others">ğŸ‘¥ æœ‰åŒäº‹/å®¶äººåœ¨åœº</div>
            </div>
        </div>

        <div class="question">
            <div class="question-title">ğŸ“ ä½ è§‰å¾—èµ·èº«ä¼šæœ‰ç¤¾ä¼šå‹åŠ›å—ï¼Ÿ</div>
            <div class="options">
                <div class="option" data-value="pressure-none">ğŸ˜Š å®Œå…¨ä¸ä¼šï¼Œæˆ‘è¯¥ç«™å°±ç«™</div>
                <div class="option" data-value="pressure-little">ğŸ™‚ æœ‰ä¸€ç‚¹ï¼Œä½†è¿˜æ˜¯ç«™äº†</div>
                <div class="option" data-value="pressure-medium">ğŸ¤” ä¼šçŠ¹è±«ï¼Œé™¤éæœ‰ç‰¹åˆ«çš„ç†ç”±</div>
                <div class="option" data-value="pressure-high">ğŸ˜£ å¾ˆéš¾åœ¨åˆ«äººé¢å‰ç«™èµ·æ¥</div>
            </div>
        </div>

        <div class="question">
            <div class="question-title">ğŸ’­ æƒ³è¯´çš„è¯</div>
            <textarea class="other-input" 
                      placeholder="æœ‰ä»€ä¹ˆæƒ³è¯´çš„éƒ½å¯ä»¥å†™åœ¨è¿™é‡Œ..." 
                      id="additional-thoughts" 
                      style="height: 100px; resize: vertical;"
                      rows="4"></textarea>
        </div>

        <button class="submit-btn" onclick="generateAndDownload()">ç”ŸæˆæŠ¥å‘Šå¹¶ä¸‹è½½</button>
    </div>

    <!-- æ·»åŠ æŠ¥å‘Šå®¹å™¨ -->
    <div id="report-container">
        <div class="report-header">
            <h1>ğŸ“… å•æ¬¡èµ·èº«è®°å½•æŠ¥å‘Š</h1>
        </div>
        <div class="report-content">
            <div class="report-item" id="report-date"></div>
            <div class="report-item" id="report-time"></div>
            <div class="report-item" id="report-duration"></div>
            <div class="report-item" id="report-reason"></div>
            <div class="report-item" id="report-status"></div>
            <div class="report-item" id="report-mood"></div>
            <div class="report-item" id="report-activity"></div>
            <div class="report-item" id="report-additional-thoughts"></div>
        </div>
        <div class="report-footer">
            ğŸ’ æ¸©é¦¨æç¤ºï¼šè®°å¾—é€‚æ—¶èµ·èº«æ´»åŠ¨ï¼Œä¿æŒå¥åº·å“¦ï¼
        </div>
    </div>

    <!-- æ·»åŠ åŠ è½½æç¤º -->
    <div class="loading">æ­£åœ¨ç”ŸæˆæŠ¥å‘Šå›¾ç‰‡...</div>

    <script>
        // å¤„ç†é€‰é¡¹é€‰æ‹©
        document.querySelectorAll('.option').forEach(option => {
            option.addEventListener('click', function() {
                const parent = this.parentElement;
                // æ‰€æœ‰é€‰é¡¹éƒ½æ”¯æŒç‚¹å‡»åˆ‡æ¢é€‰æ‹©çŠ¶æ€
                this.classList.toggle('selected');
                
                // å¤„ç†"å…¶ä»–"é€‰é¡¹çš„è¾“å…¥æ¡†æ˜¾ç¤º
                if (this.dataset.value === 'other') {
                    const input = this.parentElement.nextElementSibling;
                    if (this.classList.contains('selected')) {
                        input.style.display = 'block';
                    } else {
                        input.style.display = 'none';
                    }
                }
            });
        });

        // å¤„ç†è¯„åˆ†é€‰æ‹©
        document.querySelectorAll('.rating-option').forEach(option => {
            option.addEventListener('click', function() {
                const parent = this.parentElement;
                // è¯„åˆ†é€‰é¡¹ä¿æŒå•é€‰
                parent.querySelectorAll('.rating-option').forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
            });
        });

        // ä¿®æ”¹ç”ŸæˆæŠ¥å‘Šçš„å‡½æ•°
        async function generateAndDownload() {
            // è·å–æ‰€æœ‰é—®é¢˜çš„ç­”æ¡ˆ
            const answers = {
                sittingDuration: getSelectedValue('.container .question:nth-child(2) .option'),
                reasons: getSelectedValues('.container .question:nth-child(3) .option'),
                otherReason: document.getElementById('other-reason').value,
                mood: getSelectedValue('.container .question:nth-child(4) .option'),
                accept: getSelectedValue('.container .question:nth-child(5) .option'),
                task: getSelectedValue('.container .question:nth-child(6) .option'),
                otherTask: document.getElementById('other-task').value,
                activity: getSelectedValues('.container .question:nth-child(7) .option'),
                otherActivity: document.getElementById('other-activity').value,
                activityDuration: getSelectedValue('.container .question:nth-child(8) .option'),
                status: getSelectedValue('.container .question:nth-child(9) .option'),
                otherStatus: document.getElementById('other-status').value,
                alone: getSelectedValue('.container .question:nth-child(10) .option'),
                pressure: getSelectedValue('.container .question:nth-child(11) .option'),
                additionalThoughts: document.getElementById('additional-thoughts').value
            };

            // å¤„ç†å…¶ä»–é€‰é¡¹çš„æ–‡æœ¬
            if (answers.reasons.includes('ğŸ‘‰ å…¶ä»–') && answers.otherReason) {
                const index = answers.reasons.indexOf('ğŸ‘‰ å…¶ä»–');
                answers.reasons[index] = answers.otherReason;
            }
            
            if (answers.task === 'å…¶ä»–' && answers.otherTask) {
                answers.task = answers.otherTask;
            }
            
            if (answers.activity.includes('å…¶ä»–') && answers.otherActivity) {
                const index = answers.activity.indexOf('å…¶ä»–');
                answers.activity[index] = answers.otherActivity;
            }
            
            if (answers.status === 'å…¶ä»–' && answers.otherStatus) {
                answers.status = answers.otherStatus;
            }

            // è·å–å½“å‰æ—¥æœŸå’Œæ—¶é—´
            const now = new Date();
            const dateStr = now.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            const timeStr = now.toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });

            // åˆ›å»ºæ‰€æœ‰æŠ¥å‘Šé¡¹
            const reportItems = [
                { label: 'ğŸ“† è®°å½•æ—¥æœŸ', value: dateStr },
                { label: 'â° è®°å½•æ—¶é—´', value: timeStr },
                { label: 'ğŸ“ è¿ç»­ä¹…åæ—¶é•¿', value: answers.sittingDuration || 'æœªé€‰æ‹©' },
                { label: 'ğŸ“ èµ·èº«åŸå› ', value: answers.reasons.length > 0 ? answers.reasons.join('ã€') : 'æœªé€‰æ‹©' },
                { label: 'ğŸ“ æé†’å¿ƒæƒ…', value: answers.mood || 'æœªé€‰æ‹©' },
                { label: 'ğŸ“ æé†’æ–¹å¼æ¥å—åº¦', value: answers.accept || 'æœªé€‰æ‹©' },
                { label: 'ğŸ“ å½“å‰æ´»åŠ¨', value: answers.task || 'æœªé€‰æ‹©' },
                { label: 'ğŸ“ èµ·èº«ååšäº†ä»€ä¹ˆ', value: answers.activity.length > 0 ? answers.activity.join('ã€') : 'æœªé€‰æ‹©' },
                { label: 'ğŸ“ æ´»åŠ¨æŒç»­æ—¶é—´', value: answers.activityDuration || 'æœªé€‰æ‹©' },
                { label: 'ğŸ“ è¿”å›åº§ä½åçŠ¶æ€', value: answers.status || 'æœªé€‰æ‹©' },
                { label: 'ğŸ“ æ˜¯å¦ç‹¬å¤„', value: answers.alone || 'æœªé€‰æ‹©' },
                { label: 'ğŸ“ ç¤¾ä¼šå‹åŠ›', value: answers.pressure || 'æœªé€‰æ‹©' },
                { label: 'ğŸ’­ æƒ³è¯´çš„è¯', value: answers.additionalThoughts || 'æ— ' }
            ];

            // æ¸…ç©ºæŠ¥å‘Šå†…å®¹
            const reportContent = document.querySelector('.report-content');
            reportContent.innerHTML = '';

            // æ·»åŠ æ‰€æœ‰æŠ¥å‘Šé¡¹åˆ°æŠ¥å‘Šå†…å®¹ä¸­
            reportItems.forEach(item => {
                const element = document.createElement('div');
                element.className = 'report-item';
                element.textContent = `${item.label}ï¼š${item.value}`;
                reportContent.appendChild(element);
            });

            // æ˜¾ç¤ºåŠ è½½æç¤º
            document.querySelector('.loading').style.display = 'block';

            try {
                // ä¸´æ—¶æ˜¾ç¤ºæŠ¥å‘Šå®¹å™¨
                const reportContainer = document.getElementById('report-container');
                reportContainer.style.display = 'block';
                reportContainer.style.top = '0';
                reportContainer.style.left = '0';
                reportContainer.style.position = 'fixed';
                reportContainer.style.width = '100%';
                reportContainer.style.height = '100%';
                reportContainer.style.overflow = 'auto';
                reportContainer.style.backgroundColor = 'rgba(255, 255, 255, 0.95)';

                // ç”Ÿæˆå›¾ç‰‡
                const canvas = await html2canvas(reportContainer, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    logging: false,
                    width: 600,
                    height: reportContainer.scrollHeight + 100
                });

                // æ¢å¤æŠ¥å‘Šå®¹å™¨æ ·å¼
                reportContainer.style.display = 'none';
                reportContainer.style.top = '-9999px';
                reportContainer.style.left = '-9999px';
                reportContainer.style.position = 'fixed';
                reportContainer.style.width = '600px';
                reportContainer.style.height = 'auto';
                reportContainer.style.overflow = 'visible';
                reportContainer.style.backgroundColor = '#ffffff';

                // è½¬æ¢ä¸ºå›¾ç‰‡
                const img = canvas.toDataURL('image/png');
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const a = document.createElement('a');
                a.href = img;
                a.download = `å•æ¬¡èµ·èº«è®°å½•_${dateStr.replace(/\s+/g, '_')}_${timeStr.replace(/:/g, '-')}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

                // ä¸‹è½½å®Œæˆåæ˜¾ç¤ºåˆ†äº«é€‰é¡¹
                setTimeout(() => {
                    const shareDialog = document.createElement('div');
                    shareDialog.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: white;
                        padding: 20px;
                        border-radius: 15px;
                        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                        z-index: 1000;
                        text-align: center;
                    `;
                    shareDialog.innerHTML = `
                        <h3 style="margin-bottom: 15px;">åˆ†äº«åˆ°å¾®ä¿¡</h3>
                        <button onclick="shareToWeChat('${img}')" 
                                style="background: #07C160; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                            æ‰“å¼€å¾®ä¿¡
                        </button>
                        <button onclick="this.parentElement.remove()" 
                                style="background: #f5f5f5; color: #666; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-left: 10px;">
                            å–æ¶ˆ
                        </button>
                    `;
                    document.body.appendChild(shareDialog);
                }, 1000);

            } catch (error) {
                console.error('ç”Ÿæˆå›¾ç‰‡æ—¶å‡ºé”™:', error);
                alert('ç”Ÿæˆå›¾ç‰‡æ—¶å‡ºé”™ï¼Œè¯·é‡è¯•');
            } finally {
                // éšè—åŠ è½½æç¤º
                document.querySelector('.loading').style.display = 'none';
            }
        }

        // æ·»åŠ åˆ†äº«åˆ°å¾®ä¿¡çš„å‡½æ•°
        async function shareToWeChat(imgDataUrl) {
            try {
                // è·å–å½“å‰æ—¶é—´æˆ³
                const timestamp = new Date().getTime();
                const fileName = `å•æ¬¡èµ·èº«è®°å½•_${timestamp}.png`;
                
                // å°†base64å›¾ç‰‡è½¬æ¢ä¸ºBlob
                const response = await fetch(imgDataUrl);
                const blob = await response.blob();
                const file = new File([blob], fileName, { type: 'image/png' });
                
                // å°è¯•ä½¿ç”¨ç³»ç»Ÿåˆ†äº«API
                if (navigator.share) {
                    await navigator.share({
                        title: 'å•æ¬¡èµ·èº«è®°å½•',
                        text: 'æŸ¥çœ‹æˆ‘çš„èµ·èº«è®°å½•',
                        files: [file]
                    });
                } else {
                    // å¦‚æœä¸æ”¯æŒç³»ç»Ÿåˆ†äº«APIï¼Œå°è¯•ä½¿ç”¨å¾®ä¿¡URL Scheme
                    const wechatUrl = `weixin://dl/chat?scene=0&title=å•æ¬¡èµ·èº«è®°å½•&desc=æŸ¥çœ‹æˆ‘çš„èµ·èº«è®°å½•&url=${encodeURIComponent(window.location.href)}&imageUrl=${encodeURIComponent(imgDataUrl)}&timestamp=${timestamp}`;
                    window.location.href = wechatUrl;
                    
                    // å¦‚æœ3ç§’åè¿˜åœ¨å½“å‰é¡µé¢ï¼Œè¯´æ˜å¯èƒ½æ²¡æœ‰å®‰è£…å¾®ä¿¡æˆ–æ‰“å¼€å¤±è´¥
                    setTimeout(() => {
                        if (document.hidden === false) {
                            alert('è¯·ç¡®ä¿å·²å®‰è£…å¾®ä¿¡å¹¶ç™»å½•');
                        }
                    }, 3000);
                }
            } catch (err) {
                console.error('åˆ†äº«å¤±è´¥:', err);
                alert('åˆ†äº«å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ‰“å¼€å¾®ä¿¡åˆ†äº«');
            }
        }

        function getSelectedValue(selector) {
            const selected = document.querySelector(`${selector}.selected`);
            return selected ? selected.textContent.trim() : '';
        }

        function getSelectedValues(selector) {
            return Array.from(document.querySelectorAll(`${selector}.selected`))
                .map(el => el.textContent.trim());
        }
    </script>
</body>
</html> 